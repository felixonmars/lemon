2010-08-02 | New API

The current API for creating a Lemon unit testcase looks like this:

    covers 'someclass'

    testcase SomeClass do

      unit :some_method => "does something or another" do
        # ...
      end

    end

The design is little more than a means of organization, orienting the developer
to think in terms of test units. What is does not do is enforce the actual
testing the the unit referenced. We could put any old mess in the unit block
and as long as it did not raise an exception, it would get a *pass*.

Taking some time to consider this in depth, I've concieved of a way in which
that use of the method could in fact be enforced.

    covers 'someclass'

    testcase SomeClass do

      setup do
        SomeClass.new
      end

      unit :some_method => "does something or another" do |unit|
        unit.object        # object from setup
        unit.returns :foo  # mock a return expectation
        unit.call          # calls #some_method on unit.object
      end

    end

What is intersting about this, beyond that fact that it enforces the use of
the class or module and method involved, but that it also does so in
a way naturally suited to mocking.

